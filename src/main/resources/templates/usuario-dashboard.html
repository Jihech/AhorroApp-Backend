<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel del Usuario</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link th:href="@{/vendor/fontawesome-free/css/all.min.css}" rel="stylesheet" />
    <link th:href="@{/css/sb-admin-2.min.css}" rel="stylesheet" />
    <link th:href="@{/css/usuario-dashboard.css}" rel="stylesheet" />
</head>
<body class="bg-dark">
<div class="container mt-5">

    <!-- Bienvenida -->
    <h1 class="text-center mb-4 text-white">
        <i class="fas fa-user"></i> Bienvenido, <span th:text="${usuario.nombre}">Usuario</span>
    </h1>

    <!-- Mensajes -->
    <div th:if="${mensaje}" class="alert alert-success alert-dismissible fade show" role="alert">
        <span th:text="${mensaje}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div th:if="${mensajeError}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <span th:text="${mensajeError}"></span>
        <button type="button" class="close" data-dismiss="alert" aria-label="Cerrar">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>

    <!-- Botón agregar movimiento -->
    <div class="text-center mb-4">
        <a th:href="@{/usuario/movimiento/nuevo}" class="btn btn-primary">
            <i class="fas fa-plus-circle"></i> Agregar Movimiento
        </a>
    </div>

    <!-- Tarjetas resumen -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card bg-primary text-white shadow">
                <div class="card-body text-center">
                    💰 Ingresos
                    <div class="animated-number mt-2" th:data-valor="${ingresos}">S/. 0.00</div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card bg-danger text-white shadow">
                <div class="card-body text-center">
                    💸 Gastos
                    <div class="animated-number mt-2" th:data-valor="${gastos}">S/. 0.00</div>
                </div>
            </div>
        </div>
        <div class="col-md-4 mb-3">
            <div class="card bg-success text-white shadow">
                <div class="card-body text-center">
                    📊 Balance
                    <div class="animated-number mt-2" th:data-valor="${balance}">S/. 0.00</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Progreso de ahorro -->
    <div class="card bg-dark border-light mb-4 shadow">
        <div class="card-header bg-secondary text-white">
            <h6 class="m-0 font-weight-bold">🏦 Meta de ahorro</h6>
        </div>
        <div class="card-body text-white">
            <p>
                Has ahorrado <strong th:text="'S/. ' + ${ahorroActual}">S/. 0</strong> de
                <strong th:text="'S/. ' + ${metaAhorro}">S/. 0</strong>
            </p>
            <div class="progress">
                <div class="progress-bar bg-success" role="progressbar"
                     th:style="'width:' + (${ahorroActual} * 100 / ${metaAhorro}) + '%'"
                     th:text="(${ahorroActual} * 100 / ${metaAhorro}) + '%'">
                    0%
                </div>
            </div>
        </div>
    </div>
  

    <!-- Formulario para actualizar meta -->
    <form th:action="@{/usuario/actualizar-meta}" method="post" class="mt-3">
        <div class="input-group">
            <input type="number" step="0.01" min="1" name="nuevaMeta" th:value="${metaAhorro}"
                   class="form-control bg-dark text-white" placeholder="Nueva meta de ahorro" required>
            <div class="input-group-append">
                <button type="submit" class="btn btn-success">Actualizar</button>
            </div>
        </div>
    </form>
    </br>

    <!-- Tabla de últimos movimientos -->
    <div class="card shadow mb-4 bg-dark border-light">
        <div class="card-header bg-secondary text-white">
            <h6 class="m-0 font-weight-bold">📄 Últimos movimientos</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover table-bordered text-white">
                    <thead class="bg-dark text-white">
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Descripción</th>
                            <th>Monto</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="mov : ${ultimosMovimientos}">
                            <td th:text="${mov.fecha}">Fecha</td>
                            <td th:text="${mov.tipo}">Tipo</td>
                            <td th:text="${mov.descripcion}">Descripción</td>
                            <td th:text="'S/. ' + ${mov.monto}">Monto</td>
                        </tr>
                        <tr th:if="${#lists.isEmpty(ultimosMovimientos)}">
                            <td colspan="4" class="text-center">No hay movimientos registrados.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Consejo -->
    <div class="alert alert-warning fade-out">
        <strong>💡 Consejo:</strong> Intenta ahorrar primero y gastar después. No al revés.
    </div>

    <!-- Logout -->
    <div class="text-center mt-4">
        <a th:href="@{/logout}" class="btn btn-outline-light">
            <i class="fas fa-sign-out-alt"></i> Cerrar sesión
        </a>
    </div>
</div>

<!-- JS -->
<script th:inline="javascript">
    /*<![CDATA[*/
    const ingresos = /*[[${ingresos}]]*/ 0;
    const gastos = /*[[${gastos}]]*/ 0;
    const balance = /*[[${balance}]]*/ 0;
    const ahorroActual = /*[[${ahorroActual}]]*/ 0;
    const metaAhorro = /*[[${metaAhorro}]]*/ 0;
    /*]]>*/
</script>
<script th:src="@{/js/usuario-dashboard.js}"></script>

</body>
</html>
